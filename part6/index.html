<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 3.14.6"/><link rel="icon" href="/databases/favicon-32x32.png?v=dd253edc615d56282c5dcdfb24ca4261" type="image/png"/><link rel="manifest" href="/databases/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#a2466c"/><link rel="apple-touch-icon" sizes="48x48" href="/databases/icons/icon-48x48.png?v=dd253edc615d56282c5dcdfb24ca4261"/><link rel="apple-touch-icon" sizes="72x72" href="/databases/icons/icon-72x72.png?v=dd253edc615d56282c5dcdfb24ca4261"/><link rel="apple-touch-icon" sizes="96x96" href="/databases/icons/icon-96x96.png?v=dd253edc615d56282c5dcdfb24ca4261"/><link rel="apple-touch-icon" sizes="144x144" href="/databases/icons/icon-144x144.png?v=dd253edc615d56282c5dcdfb24ca4261"/><link rel="apple-touch-icon" sizes="192x192" href="/databases/icons/icon-192x192.png?v=dd253edc615d56282c5dcdfb24ca4261"/><link rel="apple-touch-icon" sizes="256x256" href="/databases/icons/icon-256x256.png?v=dd253edc615d56282c5dcdfb24ca4261"/><link rel="apple-touch-icon" sizes="384x384" href="/databases/icons/icon-384x384.png?v=dd253edc615d56282c5dcdfb24ca4261"/><link rel="apple-touch-icon" sizes="512x512" href="/databases/icons/icon-512x512.png?v=dd253edc615d56282c5dcdfb24ca4261"/><title data-react-helmet="true">Data integrity</title><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link as="script" rel="preload" href="/databases/webpack-runtime-268f6552388089c91965.js"/><link as="script" rel="preload" href="/databases/framework-d79a9ccabaa25efea902.js"/><link as="script" rel="preload" href="/databases/app-ed530a94b36d312dc3da.js"/><link as="script" rel="preload" href="/databases/commons-2a140772cd0d960d3ca2.js"/><link as="script" rel="preload" href="/databases/component---src-templates-docs-js-c82167b9612215b3fdf2.js"/><link as="fetch" rel="preload" href="/databases/page-data/part6/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/databases/page-data/sq/d/1885717130.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/databases/page-data/sq/d/1950529541.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/databases/page-data/sq/d/2744905544.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/databases/page-data/sq/d/3020054368.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/databases/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
  var mode = localStorage.getItem('theme-ui-color-mode');
  if (!mode) return
  document.documentElement.classList.add('theme-ui-' + mode);
} catch (e) {} })();</script><div id="___gatsby"><style data-emotion="css-global xghfnh">html{--theme-ui-colors-header:#fff;--theme-ui-colors-text:#000;--theme-ui-colors-primary:#E10E49;--theme-ui-colors-secondary:#c70d3a;--theme-ui-colors-highlight:#efeffe;--theme-ui-colors-exercise:#3333ee;--theme-ui-colors-sidebar:#f8f5f1;--theme-ui-colors-background:#fff;--theme-ui-colors-borderColor:rgba(0, 0, 0, 0.15);--theme-ui-colors-footer:#E10E49;color:var(--theme-ui-colors-text);background-color:var(--theme-ui-colors-background);}</style><style data-emotion="css-global dcnl1w">*{box-sizing:border-box;}html{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.5;font-weight:400;}html h1{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.125;font-weight:700;margin-top:0;margin-bottom:16px;font-size:36px;}html h1::before{content:" ";display:block;padding-top:30px;margin-bottom:40px;border-bottom:1px solid;border-bottom-color:var(--theme-ui-colors-borderColor);}html h2{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.125;font-weight:700;margin-top:0;margin-bottom:16px;font-size:28px;}html h2::before{content:" ";display:block;padding-top:30px;margin-bottom:40px;border-bottom:1px solid;border-bottom-color:var(--theme-ui-colors-borderColor);}html h3{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.125;font-weight:700;margin-top:0;margin-bottom:16px;font-size:24px;}html h3::before{content:" ";display:block;padding-top:30px;margin-bottom:40px;border-bottom:1px solid;border-bottom-color:var(--theme-ui-colors-borderColor);}html h4{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.125;font-weight:700;margin-top:0;margin-bottom:16px;font-size:16px;}html h4::before{content:" ";display:block;padding-top:30px;margin-bottom:40px;border-bottom:1px solid;border-bottom-color:var(--theme-ui-colors-borderColor);}html h5{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.125;font-weight:700;margin-top:0;margin-bottom:16px;font-size:14px;}html h5::before{content:" ";display:block;padding-top:30px;margin-bottom:40px;border-bottom:1px solid;border-bottom-color:var(--theme-ui-colors-borderColor);}html h6{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.125;font-weight:700;margin-top:0;margin-bottom:16px;font-size:12px;}html h6::before{content:" ";display:block;padding-top:30px;margin-bottom:40px;border-bottom:1px solid;border-bottom-color:var(--theme-ui-colors-borderColor);}body{margin:0;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css ylfa0c">.css-ylfa0c{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.5;font-weight:400;}.css-ylfa0c h1{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.125;font-weight:700;margin-top:0;margin-bottom:16px;font-size:36px;}.css-ylfa0c h1::before{content:" ";display:block;padding-top:30px;margin-bottom:40px;border-bottom:1px solid;border-bottom-color:var(--theme-ui-colors-borderColor);}.css-ylfa0c h2{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.125;font-weight:700;margin-top:0;margin-bottom:16px;font-size:28px;}.css-ylfa0c h2::before{content:" ";display:block;padding-top:30px;margin-bottom:40px;border-bottom:1px solid;border-bottom-color:var(--theme-ui-colors-borderColor);}.css-ylfa0c h3{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.125;font-weight:700;margin-top:0;margin-bottom:16px;font-size:24px;}.css-ylfa0c h3::before{content:" ";display:block;padding-top:30px;margin-bottom:40px;border-bottom:1px solid;border-bottom-color:var(--theme-ui-colors-borderColor);}.css-ylfa0c h4{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.125;font-weight:700;margin-top:0;margin-bottom:16px;font-size:16px;}.css-ylfa0c h4::before{content:" ";display:block;padding-top:30px;margin-bottom:40px;border-bottom:1px solid;border-bottom-color:var(--theme-ui-colors-borderColor);}.css-ylfa0c h5{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.125;font-weight:700;margin-top:0;margin-bottom:16px;font-size:14px;}.css-ylfa0c h5::before{content:" ";display:block;padding-top:30px;margin-bottom:40px;border-bottom:1px solid;border-bottom-color:var(--theme-ui-colors-borderColor);}.css-ylfa0c h6{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.125;font-weight:700;margin-top:0;margin-bottom:16px;font-size:12px;}.css-ylfa0c h6::before{content:" ";display:block;padding-top:30px;margin-bottom:40px;border-bottom:1px solid;border-bottom-color:var(--theme-ui-colors-borderColor);}</style><div class="css-ylfa0c"><style data-emotion="css-global 5u4lmb">:root{--ease-in-quad:cubic-bezier(0.55, 0.085, 0.68, 0.53);--ease-in-quart:cubic-bezier(0.895, 0.03, 0.685, 0.22);--ease-out-quad:cubic-bezier(0.25, 0.46, 0.45, 0.94);--ease-out-quart:cubic-bezier(0.165, 0.84, 0.44, 1);--ease-in-out-quad:cubic-bezier(0.455, 0.03, 0.515, 0.955);--ease-in-out-quart:cubic-bezier(0.77, 0, 0.175, 1);}*,*:before,*:after{box-sizing:inherit;}:root{box-sizing:border-box;}body{margin:0;}.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;}</style><style data-emotion="css dl5fst">.css-dl5fst{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:1rem 1rem;z-index:5;background:var(--theme-ui-colors-header);-webkit-transition:all 0.25s var(--ease-in-out-quad);transition:all 0.25s var(--ease-in-out-quad);border-bottom:1px solid var(--theme-ui-colors-borderColor);}@media (min-width: 38.73684210526316em){.css-dl5fst{position:fixed;top:0;left:0;right:0;padding:1rem 1.2rem;-webkit-transform:translateX(0);-moz-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0);}}</style><header class="css-dl5fst eneaom32"><style data-emotion="css 13apmpg">.css-13apmpg{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:0;text-alight:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-13apmpg eneaom30"><style data-emotion="css 1gp7fjh">.css-1gp7fjh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-right:1rem;}@media (min-width: 38.73684210526316em){.css-1gp7fjh{display:none;}}</style><div class="css-1gp7fjh eneaom31"><style data-emotion="css i05np8">.css-i05np8{padding:0;background:none;border:none;color:var(--theme-ui-colors-text);cursor:pointer;font-size:0.8rem;}.css-i05np8:hover{color:var(--theme-ui-colors-primary);}</style><button type="button" aria-label="Open Navigation" title="Open Navigation" class="css-i05np8 e1onh9ai0"><style data-emotion="css z2vy6x">.css-z2vy6x{display:inline-block;width:30px;height:30px;}</style><span size="30" class="css-z2vy6x e1jw6cnh0"><style data-emotion="css 17rqqes">.css-17rqqes{fill:var(--theme-ui-colors-text);-webkit-transition:all 0.2s ease-out;transition:all 0.2s ease-out;}.css-17rqqes:hover,.css-17rqqes:focus{fill:var(--theme-ui-colors-primary);}</style><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="css-17rqqes e15jrc190"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></span></button></div><style data-emotion="css 13bl6n6">.css-13bl6n6{width:10rem;}.css-13bl6n6 p{margin:0;font-size:1.6rem;}</style><div class="css-13bl6n6 ewwdldv1"><style data-emotion="css o97vb3">.css-o97vb3{display:block;-webkit-text-decoration:none;text-decoration:none;color:var(--theme-ui-colors-text);-webkit-transition:color 0.2s ease-out;transition:color 0.2s ease-out;}.css-o97vb3:hover,.css-o97vb3:focus{color:var(--theme-ui-colors-primary);}</style><a class="css-o97vb3 ewwdldv0" href="/databases/"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2641px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1219&#x27; width=&#x27;2641&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/avif" data-srcset="/databases/static/7c5268770640a4d118046a43d1aa9fe2/9469b/Centria-tunnus-RGB-FI-marginaalilla.avif 660w,/databases/static/7c5268770640a4d118046a43d1aa9fe2/bb0ac/Centria-tunnus-RGB-FI-marginaalilla.avif 1321w,/databases/static/7c5268770640a4d118046a43d1aa9fe2/7558a/Centria-tunnus-RGB-FI-marginaalilla.avif 2641w" sizes="(min-width: 2641px) 2641px, 100vw"/><source type="image/webp" data-srcset="/databases/static/7c5268770640a4d118046a43d1aa9fe2/9ecf4/Centria-tunnus-RGB-FI-marginaalilla.webp 660w,/databases/static/7c5268770640a4d118046a43d1aa9fe2/316a0/Centria-tunnus-RGB-FI-marginaalilla.webp 1321w,/databases/static/7c5268770640a4d118046a43d1aa9fe2/93023/Centria-tunnus-RGB-FI-marginaalilla.webp 2641w" sizes="(min-width: 2641px) 2641px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2641px) 2641px, 100vw" decoding="async" loading="lazy" data-src="/databases/static/7c5268770640a4d118046a43d1aa9fe2/0cf45/Centria-tunnus-RGB-FI-marginaalilla.jpg" data-srcset="/databases/static/7c5268770640a4d118046a43d1aa9fe2/39f99/Centria-tunnus-RGB-FI-marginaalilla.jpg 660w,/databases/static/7c5268770640a4d118046a43d1aa9fe2/844fa/Centria-tunnus-RGB-FI-marginaalilla.jpg 1321w,/databases/static/7c5268770640a4d118046a43d1aa9fe2/0cf45/Centria-tunnus-RGB-FI-marginaalilla.jpg 2641w" alt="Centria banner"/></picture><noscript><picture><source type="image/avif" srcSet="/databases/static/7c5268770640a4d118046a43d1aa9fe2/9469b/Centria-tunnus-RGB-FI-marginaalilla.avif 660w,/databases/static/7c5268770640a4d118046a43d1aa9fe2/bb0ac/Centria-tunnus-RGB-FI-marginaalilla.avif 1321w,/databases/static/7c5268770640a4d118046a43d1aa9fe2/7558a/Centria-tunnus-RGB-FI-marginaalilla.avif 2641w" sizes="(min-width: 2641px) 2641px, 100vw"/><source type="image/webp" srcSet="/databases/static/7c5268770640a4d118046a43d1aa9fe2/9ecf4/Centria-tunnus-RGB-FI-marginaalilla.webp 660w,/databases/static/7c5268770640a4d118046a43d1aa9fe2/316a0/Centria-tunnus-RGB-FI-marginaalilla.webp 1321w,/databases/static/7c5268770640a4d118046a43d1aa9fe2/93023/Centria-tunnus-RGB-FI-marginaalilla.webp 2641w" sizes="(min-width: 2641px) 2641px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2641px) 2641px, 100vw" decoding="async" loading="lazy" src="/databases/static/7c5268770640a4d118046a43d1aa9fe2/0cf45/Centria-tunnus-RGB-FI-marginaalilla.jpg" srcSet="/databases/static/7c5268770640a4d118046a43d1aa9fe2/39f99/Centria-tunnus-RGB-FI-marginaalilla.jpg 660w,/databases/static/7c5268770640a4d118046a43d1aa9fe2/844fa/Centria-tunnus-RGB-FI-marginaalilla.jpg 1321w,/databases/static/7c5268770640a4d118046a43d1aa9fe2/0cf45/Centria-tunnus-RGB-FI-marginaalilla.jpg 2641w" alt="Centria banner"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div></a></div></div></header><style data-emotion="css pn4xbf">.css-pn4xbf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;min-height:100vh;position:relative;overflow-x:hidden;background:var(--theme-ui-colors-background);-webkit-transition:background 0.25s var(--ease-in-out-quad);transition:background 0.25s var(--ease-in-out-quad);}</style><div class="css-pn4xbf e1krdi8y3"><style data-emotion="css 1oex1pb">.css-1oex1pb{margin-left:-19rem;-webkit-flex:0 0 19rem;-ms-flex:0 0 19rem;flex:0 0 19rem;font-size:0.875rem;}@media (min-width: 38.73684210526316em){.css-1oex1pb{margin-left:0;}}</style><aside class="css-1oex1pb ednv8641"><style data-emotion="css 1wrooys">.css-1wrooys{position:fixed;top:0;bottom:0;overflow-x:hidden;overflow-y:auto;width:19rem;height:100%;padding:1rem 0;background:var(--theme-ui-colors-sidebar);-webkit-transition:0.25s var(--ease-in-out-quad);transition:0.25s var(--ease-in-out-quad);}@media (min-width: 38.73684210526316em){.css-1wrooys{-webkit-transform:translateX(0);-moz-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0);padding:6.6rem 0 1rem;}}</style><nav class="css-1wrooys ednv8640"><style data-emotion="css pv1s1f">.css-pv1s1f{margin:0;padding:0;list-style:none;}</style><ul class="css-pv1s1f e1dzqqml0"><style data-emotion="css 1lbpo2j">.css-1lbpo2j{position:relative;display:block;padding:0;margin:0.2rem 0;width:100%;list-style:none;}</style><li class="css-1lbpo2j eo1v1f02"><style data-emotion="css 2kw81a">.css-2kw81a{margin:0.5rem 0 0.5rem 1.2rem;padding:0;list-style:none;}.css-2kw81a>li{margin:0;}</style><ul class="css-2kw81a eo1v1f00"><li class="css-1lbpo2j eo1v1f02"><style data-emotion="css zl329z">.css-zl329z{display:block;padding:0.5rem 1.8rem 0.5rem 1.2rem;width:100%;color:var(--theme-ui-colors-text);font-weight:600;-webkit-text-decoration:none;text-decoration:none;-webkit-transition:color 0.2s ease-out;transition:color 0.2s ease-out;}.css-zl329z:hover,.css-zl329z:focus,.css-zl329z.is-active{color:var(--theme-ui-colors-primary);}</style><a class="css-zl329z eo1v1f01" href="/databases/part1">First steps</a></li><li class="css-1lbpo2j eo1v1f02"><a class="css-zl329z eo1v1f01" href="/databases/part2">SQL Basics</a></li><li class="css-1lbpo2j eo1v1f02"><a class="css-zl329z eo1v1f01" href="/databases/part3">Multible tables</a></li><li class="css-1lbpo2j eo1v1f02"><a class="css-zl329z eo1v1f01" href="/databases/part4">More techniques</a></li><li class="css-1lbpo2j eo1v1f02"><a class="css-zl329z eo1v1f01" href="/databases/part5">Designing databases</a></li><li class="css-1lbpo2j eo1v1f02"><a aria-current="page" class="css-zl329z eo1v1f01 is-active" href="/databases/part6">Data integrity</a></li><li class="css-1lbpo2j eo1v1f02"><a class="css-zl329z eo1v1f01" href="/databases/part7">Efficiency</a></li><li class="css-1lbpo2j eo1v1f02"><a class="css-zl329z eo1v1f01" href="/databases/exercises">Exercises and Exam</a></li></ul></li></ul></nav></aside><style data-emotion="css 1a5xr11">.css-1a5xr11{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;min-width:20rem;padding-bottom:5rem;}</style><div class="css-1a5xr11 e1krdi8y2"><style data-emotion="css 1ni6xgg">.css-1ni6xgg{margin:auto;padding:2rem 1rem 2.5rem;-webkit-transition:0.25s var(--ease-in-out-quad);transition:0.25s var(--ease-in-out-quad);opacity:1;}@media (min-width: 38.73684210526316em){.css-1ni6xgg{-webkit-transform:translateX(0);-moz-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0);opacity:1;padding:7rem 3rem 3rem;max-width:50rem;}}</style><main class="css-1ni6xgg e1krdi8y1"><style data-emotion="css 1daj6ng">.css-1daj6ng{padding-top:0;margin-top:0;}.css-1daj6ng::before{display:none!important;}</style><h1 class="css-1daj6ng e137ubq00">Data integrity</h1><style data-emotion="css 1up8dbe">.css-1up8dbe{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.125;font-weight:700;margin-top:0;margin-bottom:16px;font-size:36px;}.css-1up8dbe::before{content:" ";display:block;padding-top:30px;margin-bottom:40px;border-bottom:1px solid;border-bottom-color:var(--theme-ui-colors-borderColor);}</style><h1 id="data-integrity" class="css-1up8dbe">Data integrity</h1><style data-emotion="css zitybv">.css-zitybv{margin-top:32px;margin-bottom:32px;}</style><p class="css-zitybv">With <em class="css-0">data integrity</em> we mean that the data in the database is current and does not have conflicts. Main responsibility of the data quality lies of course on the user or the application using the database, but also the database designer can affect the integrity by adding conditions to the tables, which monitor the information added to the database.</p><style data-emotion="css vq3asz">.css-vq3asz{font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Segoe UI,Arial,sans-serif;line-height:1.125;font-weight:700;margin-top:0;margin-bottom:16px;font-size:28px;}.css-vq3asz::before{content:" ";display:block;padding-top:30px;margin-bottom:40px;border-bottom:1px solid;border-bottom-color:var(--theme-ui-colors-borderColor);}</style><h2 id="column-conditions" class="css-vq3asz">Column conditions</h2><p class="css-zitybv">We can define conditions for the columns when we create columns, which the database systems monitors when the data is added or changed. With these conditions we can control what sort of data the database contains. Let&#x27;s look at some of the most typical conditions.</p><h2 id="unique" class="css-vq3asz">UNIQUE</h2><p class="css-zitybv">Condition <style data-emotion="css 1eipsn1">.css-1eipsn1{color:var(--theme-ui-colors-primary);background:rgba(233, 218, 172, 0.15);border-radius:3px;padding-left:0.4rem;padding-right:0.4rem;padding-top:0.2rem;padding-bottom:0.2rem;}</style><code class="css-1eipsn1">UNIQUE</code> means, that the column must have a different value on each row. For example in the following table the requirement is, that each product has a different name:</p><style data-emotion="css 14vuu3">.css-14vuu3{background-color:#282c34;color:#ffffff;font-family:"Operator Mono",monospace;font-size:0.9rem;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;border-radius:6px;padding:16px;margin-top:32px;margin-bottom:32px;}.css-14vuu3 .attr-name{color:#c5a5c5;}.css-14vuu3 .attr-value{color:#8dc891;}.css-14vuu3 .comment,.css-14vuu3 .block-comment,.css-14vuu3 .prolog,.css-14vuu3 .doctype,.css-14vuu3 .cdata,.css-14vuu3 .shebang{color:#999999;}.css-14vuu3 .property,.css-14vuu3 .number,.css-14vuu3 .function-name,.css-14vuu3 .constant,.css-14vuu3 .symbol,.css-14vuu3 .deleted{color:#5a9bcf;}.css-14vuu3 .boolean{color:#ff8b50;}.css-14vuu3 .tag{color:#fc929e;}.css-14vuu3 .string{color:#8dc891;}.css-14vuu3 .punctuation{color:#8dc891;}.css-14vuu3 .selector,.css-14vuu3 .char,.css-14vuu3 .builtin,.css-14vuu3 .inserted{color:#D8DEE9;}.css-14vuu3 .function{color:#79b6f2;}.css-14vuu3 .operator,.css-14vuu3 .entity,.css-14vuu3 .url,.css-14vuu3 .variable{color:#d7deea;}.css-14vuu3 .keyword{color:#c5a5c5;}.css-14vuu3 .at-rule,.css-14vuu3 .class-name{color:#FAC863;}.css-14vuu3 .important{font-weight:400;}.css-14vuu3 .bold{font-weight:700;}.css-14vuu3 .italic{font-style:italic;}.css-14vuu3 .namespace{opacity:0.7;}.css-14vuu3 .highlight{background-color:var(--theme-ui-colors-highlight);font-weight:700;}</style><style data-emotion="css 1itelf7">.css-1itelf7{background-color:#282c34;color:#ffffff;font-family:"Operator Mono",monospace;font-size:0.9rem;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;border-radius:6px;padding:16px;margin-top:32px;margin-bottom:32px;}.css-1itelf7 .attr-name{color:#c5a5c5;}.css-1itelf7 .attr-value{color:#8dc891;}.css-1itelf7 .comment,.css-1itelf7 .block-comment,.css-1itelf7 .prolog,.css-1itelf7 .doctype,.css-1itelf7 .cdata,.css-1itelf7 .shebang{color:#999999;}.css-1itelf7 .property,.css-1itelf7 .number,.css-1itelf7 .function-name,.css-1itelf7 .constant,.css-1itelf7 .symbol,.css-1itelf7 .deleted{color:#5a9bcf;}.css-1itelf7 .boolean{color:#ff8b50;}.css-1itelf7 .tag{color:#fc929e;}.css-1itelf7 .string{color:#8dc891;}.css-1itelf7 .punctuation{color:#8dc891;}.css-1itelf7 .selector,.css-1itelf7 .char,.css-1itelf7 .builtin,.css-1itelf7 .inserted{color:#D8DEE9;}.css-1itelf7 .function{color:#79b6f2;}.css-1itelf7 .operator,.css-1itelf7 .entity,.css-1itelf7 .url,.css-1itelf7 .variable{color:#d7deea;}.css-1itelf7 .keyword{color:#c5a5c5;}.css-1itelf7 .at-rule,.css-1itelf7 .class-name{color:#FAC863;}.css-1itelf7 .important{font-weight:400;}.css-1itelf7 .bold{font-weight:700;}.css-1itelf7 .italic{font-style:italic;}.css-1itelf7 .namespace{opacity:0.7;}.css-1itelf7 .highlight{background-color:var(--theme-ui-colors-highlight);font-weight:700;}</style><pre class="language-sql prism-code language-sql css-1itelf7"><div class="token-line"><span class="token keyword">CREATE</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> Products </span><span class="token punctuation">(</span><span class="token plain">id </span><span class="token keyword">INTEGER</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token punctuation">,</span><span class="token plain"> name </span><span class="token keyword">TEXT</span><span class="token plain"> </span><span class="token keyword">UNIQUE</span><span class="token punctuation">,</span><span class="token plain"> price </span><span class="token keyword">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre><h2 id="not-null-and-default" class="css-vq3asz">NOT NULL and DEFAULT</h2><p class="css-zitybv">The condition <code class="css-1eipsn1">NOT NULL</code> means, that the column cannot contain the value <code class="css-1eipsn1">NULL</code>. For example in the next command the price cannot be empty:</p><pre class="language-sql prism-code language-sql css-1itelf7"><div class="token-line"><span class="token keyword">CREATE</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> Products </span><span class="token punctuation">(</span><span class="token plain">id </span><span class="token keyword">INTEGER</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token punctuation">,</span><span class="token plain"> name </span><span class="token keyword">TEXT</span><span class="token punctuation">,</span><span class="token plain"> price </span><span class="token keyword">INTEGER</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre><p class="css-zitybv">The definiton <code class="css-1eipsn1">DEFAULT</code> is often coupled with this, which gives the column a certain default value, if a value is not given when a row is added. We can give for example a default of 0 like this:</p><pre class="language-sql prism-code language-sql css-1itelf7"><div class="token-line"><span class="token keyword">CREATE</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> Products </span><span class="token punctuation">(</span><span class="token plain">id </span><span class="token keyword">INTEGER</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token punctuation">,</span><span class="token plain"> name </span><span class="token keyword">TEXT</span><span class="token punctuation">,</span><span class="token plain"> price </span><span class="token keyword">INTEGER</span><span class="token plain"> </span><span class="token keyword">DEFAULT</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre><h2 id="check" class="css-vq3asz">CHECK</h2><p class="css-zitybv">Another common way to create a condition using the keyword <code class="css-1eipsn1">CHECK</code>, after which you can write any conditional. For example the next command creates a table of products whose price condition is <code class="css-1eipsn1">price &gt;= 0</code>, which means the price cannot be negative:</p><pre class="language-sql prism-code language-sql css-1itelf7"><div class="token-line"><span class="token keyword">CREATE</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> Products </span><span class="token punctuation">(</span><span class="token plain">id </span><span class="token keyword">INTEGER</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token punctuation">,</span><span class="token plain"> name </span><span class="token keyword">TEXT</span><span class="token punctuation">,</span><span class="token plain"> price </span><span class="token keyword">CHECK</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">price </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre><h2 id="condition-monitoring" class="css-vq3asz">Condition monitoring</h2><p class="css-zitybv">The benefit of condition is that the database system monitors them and refuses to add a row or make a change, which would violate the condition. Here&#x27;s an example of this in action with SQLite.</p><pre class="prism-code language-css-0 css-1itelf7"><div class="token-line"><span class="token plain">sqlite&gt; CREATE TABLE Products (id INTEGER PRIMARY KEY, name TEXT, price CHECK (price &gt;= 0));</span></div><div class="token-line"><span class="token plain">sqlite&gt; INSERT INTO Products(name,price) VALUES (&#x27;radish&#x27;,4);</span></div><div class="token-line"><span class="token plain">sqlite&gt; INSERT INTO Products(name,price) VALUES (&#x27;celery&#x27;,7);</span></div><div class="token-line"><span class="token plain">sqlite&gt; INSERT INTO Products(name,price) VALUES (&#x27;cucumber&#x27;,-2);</span></div><div class="token-line"><span class="token plain">Error: CHECK constraint failed: Products</span></div><div class="token-line"><style data-emotion="css 13aqjzy">.css-13aqjzy{display:inline-block;}</style><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">sqlite&gt; SELECT * FROM Products;</span></div><div class="token-line"><span class="token plain">1|radish|4</span></div><div class="token-line"><span class="token plain">2|celery|7</span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">sqlite&gt; UPDATE Products SET price=-2 WHERE id=2;</span></div><div class="token-line"><span class="token plain">Error: CHECK constraint failed: Products</span></div></pre><p class="css-zitybv">When we try to add a row to the table <code class="css-1eipsn1">Products</code> with a negative price, this violates the condition <code class="css-1eipsn1">price &gt;= 0</code> and SQLite does not allow adding the row but gives an <code class="css-1eipsn1">Error: CHECK constraint failed: Products</code>. Same happens when we try to change the price of existing lines to negative afterwards.</p><h2 id="reference-conditions" class="css-vq3asz">Reference conditions</h2><p class="css-zitybv">We can also add conditions to the tables which make sure, that the references in the tables refer to actual rows. This is done by creating <code class="css-1eipsn1">foreing key</code> which describes, where does the row refer to.</p><p class="css-zitybv">Let&#x27;s look at an example:</p><pre class="language-sql prism-code language-sql css-1itelf7"><div class="token-line"><span class="token keyword">CREATE</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> Teachers </span><span class="token punctuation">(</span><span class="token plain">id </span><span class="token keyword">INTEGER</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token punctuation">,</span><span class="token plain"> name </span><span class="token keyword">TEXT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">CREATE</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> Courses </span><span class="token punctuation">(</span><span class="token plain">id </span><span class="token keyword">INTEGER</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token punctuation">,</span><span class="token plain"> name </span><span class="token keyword">TEXT</span><span class="token punctuation">,</span><span class="token plain"> teacher_id </span><span class="token keyword">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre><p class="css-zitybv">Here the purpose is that the table <code class="css-1eipsn1">Courses</code> column <code class="css-1eipsn1">teacher_id</code> references to the column <code class="css-1eipsn1">id</code> from table <code class="css-1eipsn1">Teachers</code>, but the database user can give any value for the column (for example number 123), when the database content is broken. We can make this better while creating the table <code class="css-1eipsn1">Courses</code> by telling that the column <code class="css-1eipsn1">teacher_id</code> is a <code class="css-1eipsn1">foreign key</code> to the table <code class="css-1eipsn1">Teachers</code>:</p><pre class="language-sql prism-code language-sql css-1itelf7"><div class="token-line"><span class="token keyword">CREATE</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> Courses </span><span class="token punctuation">(</span><span class="token plain">id </span><span class="token keyword">INTEGER</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token punctuation">,</span><span class="token plain"> name </span><span class="token keyword">TEXT</span><span class="token punctuation">,</span><span class="token plain"> teacher_id </span><span class="token keyword">INTEGER</span><span class="token plain"> </span><span class="token keyword">REFERENCES</span><span class="token plain"> Teachers</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre><p class="css-zitybv">Now we can trust that the values in the <code class="css-1eipsn1">Courses</code> column <code class="css-1eipsn1">teacher_id</code> refer to actual rows in table <code class="css-1eipsn1">Teachers</code>.</p><h2 id="reference-keys-in-sqlite" class="css-vq3asz">Reference keys in SQLite</h2><p class="css-zitybv">Can we actually trust, that the reference keys work in the desired ways? For historical reasons, SQLite does not monitor the reference key konditions by default, but first we have to run the following command:</p><pre class="prism-code language-css-0 css-1itelf7"><div class="token-line"><span class="token plain">sqlite&gt; PRAGMA foreign_keys = ON;</span></div></pre><p class="css-zitybv">This is specific to SQLite, and on other database systems the reference key monitoring <em class="css-0">should</em> be always monitored.</p><p class="css-zitybv">Here&#x27;s an example of using a reference key:</p><pre class="prism-code language-css-0 css-1itelf7"><div class="token-line"><span class="token plain">sqlite&gt; PRAGMA foreign_keys = ON;</span></div><div class="token-line"><span class="token plain">sqlite&gt; CREATE TABLE Teachers (id INTEGER PRIMARY KEY, name TEXT);</span></div><div class="token-line"><span class="token plain">sqlite&gt; CREATE TABLE Courses (id INTEGER PRIMARY KEY, name TEXT, teacher_id INTEGER</span></div><div class="token-line"><span class="token plain">   ...&gt;                       REFERENCES Teachers);</span></div><div class="token-line"><span class="token plain">sqlite&gt; INSERT INTO Teachers (name) VALUES (&#x27;Ahonen&#x27;);</span></div><div class="token-line"><span class="token plain">sqlite&gt; INSERT INTO Teachers (name) VALUES (&#x27;Isohanni&#x27;);</span></div><div class="token-line"><span class="token plain">sqlite&gt; SELECT * FROM Teachers;</span></div><div class="token-line"><span class="token plain">1|Ahonen</span></div><div class="token-line"><span class="token plain">2|Isohanni</span></div><div class="token-line"><span class="token plain">sqlite&gt; INSERT INTO Courses (name, teacher_id) VALUES (&#x27;Basic programming&#x27;,2);</span></div><div class="token-line"><span class="token plain">sqlite&gt; INSERT INTO Courses (name, teacher_id) VALUES (&#x27;Algebra&#x27;,123);</span></div><div class="token-line"><span class="token plain">Error: FOREIGN KEY constraint failed</span></div></pre><p class="css-zitybv">In the table <code class="css-1eipsn1">Teachers</code> we have two teachers whose <code class="css-1eipsn1">id</code> are 1 and 2. When we try to add a row to <code class="css-1eipsn1">Courses</code> where the <code class="css-1eipsn1">teacher_id</code> is 123, SQLite does not allow it and we get an error <code class="css-1eipsn1">Error: FOREIGN KEY constraint failed</code>.</p><h2 id="references-and-removals" class="css-vq3asz">References and removals</h2><p class="css-zitybv">Reference conditions have more complex situations than regular columns, as the references are between two tables. Especially important is to notice, what happens when we try to remove a row, which is being referenced to from another table?</p><p class="css-zitybv">Usually the default is that we cannot remove a row from a database, if the row is being references from elsewhere. For example, if we try to remove the row 2 from the table <code class="css-1eipsn1">Teachers</code> above, this does not work, as it is being referenced from the table <code class="css-1eipsn1">Courses</code>:</p><pre class="language-sql prism-code language-sql css-1itelf7"><div class="token-line"><span class="token plain">sqlite</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword">DELETE</span><span class="token plain"> </span><span class="token keyword">FROM</span><span class="token plain"> Teachers </span><span class="token keyword">WHERE</span><span class="token plain"> id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">Error: </span><span class="token keyword">FOREIGN</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token plain"> </span><span class="token keyword">constraint</span><span class="token plain"> failed</span></div></pre><p class="css-zitybv">If we want, we can define in table creation more cleary what happens in a situation like this. For example one option is <code class="css-1eipsn1">ON DELETE CASCADE</code>, which means that when a row is removed, so are the rows referencing to it. We can achieve it as follows:</p><pre class="language-sql prism-code language-sql css-1itelf7"><div class="token-line"><span class="token keyword">CREATE</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> Courses </span><span class="token punctuation">(</span><span class="token plain">id </span><span class="token keyword">INTEGER</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token punctuation">,</span><span class="token plain"> name </span><span class="token keyword">TEXT</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      teacher_id </span><span class="token keyword">INTEGER</span><span class="token plain"> </span><span class="token keyword">REFERENCES</span><span class="token plain"> Teachers </span><span class="token keyword">ON</span><span class="token plain"> </span><span class="token keyword">DELETE</span><span class="token plain"> </span><span class="token keyword">CASCADE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre><p class="css-zitybv">Now if we remove a teacher from the database, the courses they teach are also automatically removed. This though is often not the desired option, as this means we might lose too much information from the database.</p><h2 id="consequences-of-removal" class="css-vq3asz">Consequences of removal</h2><p class="css-zitybv">Possible options in <code class="css-1eipsn1">ON DELETE</code> are:</p><ul class="css-0"><li class="css-0"><code class="css-1eipsn1">NO ACTION</code>: &quot;don&#x27;t do anything&quot; (default)</li><li class="css-0"><code class="css-1eipsn1">RESTRICT</code>: prevent removal</li><li class="css-0"><code class="css-1eipsn1">CASCADE</code>: also remove the referencing rows</li><li class="css-0"><code class="css-1eipsn1">SET NULL</code>: change the referencing value to <code class="css-1eipsn1">NULL</code></li><li class="css-0"><code class="css-1eipsn1">SET DEFAULT</code>: change the reference to default value</li></ul><p class="css-zitybv">A puzzling notice is, that <code class="css-1eipsn1">NO ACTION</code> prevents the removal, even though the name suggests otherwise. In practice, <code class="css-1eipsn1">NO ACTION</code> and <code class="css-1eipsn1">RESTRICT</code> work almost similarly, but on some database systems and special cases there might be differences.</p><h1 id="introduction-to-transactions" class="css-1up8dbe">Introduction to transactions</h1><p class="css-zitybv">Transaction is a group of consecutive SQL commands, which the database promises to execute as a whole. The database user can trust, that either</p><ol class="css-0"><li class="css-0">All the commands are executed and the changes are permanent on the database</li><li class="css-0">Transaction is aborted and the commands do not cause any changes to the database</li></ol><h2 id="acid" class="css-vq3asz">ACID</h2><p class="css-zitybv">With transactions we come across the acronym <em class="css-0">ACID</em> quite often, which is derived from the following:</p><ul class="css-0"><li class="css-0">Atomicity: The commands in the transaction are run as a single whole.</li><li class="css-0">Consistency: The transaction keeps the database content intact.</li><li class="css-0">Isolation: Transactions are run separated from each other.</li><li class="css-0">Durability: When a transaction is completed the change is permanent.</li></ul><h2 id="transaction-phases" class="css-vq3asz">Transaction phases</h2><p class="css-zitybv">A transaction is actually quite a mundane part of database usage, as per default each SQL command is a transaction as such. Let&#x27;s look for example the next command, which increases the price of each product by one:</p><pre class="language-sql prism-code language-sql css-1itelf7"><div class="token-line"><span class="token keyword">UPDATE</span><span class="token plain"> Products </span><span class="token keyword">SET</span><span class="token plain"> price</span><span class="token operator">=</span><span class="token plain">price</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span></div></pre><p class="css-zitybv">As the command is actually a transaction, we can trust that indeed the price of each product is increased by one, or then the price of any product is not changed. The latter happens for example if the connection to database is lost during the update. Even in that situation only part of the prices would be updated.</p><p class="css-zitybv">Usually still the word transaction is used to refer to a whole of several SQL commands. Then we begin with the command <code class="css-1eipsn1">BEGIN TRANSACTION</code>, which starts the transaction. We continue by running all the necessary commands as usual, and finish with the command <code class="css-1eipsn1">COMMIT</code>, which closes the transaction.</p><p class="css-zitybv">A classic example of a transaction is a situation, where we transfer money from one bank account to another. For example the following transaction moves 100 euros from Maija&#x27;s account to Uolevi&#x27;s:</p><pre class="language-sql prism-code language-sql css-1itelf7"><div class="token-line"><span class="token keyword">BEGIN</span><span class="token plain"> </span><span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">UPDATE</span><span class="token plain"> Accounts </span><span class="token keyword">SET</span><span class="token plain"> balance</span><span class="token operator">=</span><span class="token plain">balance</span><span class="token operator">-</span><span class="token number">100</span><span class="token plain"> </span><span class="token keyword">WHERE</span><span class="token plain"> owner</span><span class="token operator">=</span><span class="token string">&#x27;Maija&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">UPDATE</span><span class="token plain"> Accounts </span><span class="token keyword">SET</span><span class="token plain"> balance</span><span class="token operator">=</span><span class="token plain">balance</span><span class="token operator">+</span><span class="token number">100</span><span class="token plain"> </span><span class="token keyword">WHERE</span><span class="token plain"> owner</span><span class="token operator">=</span><span class="token string">&#x27;Uolevi&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">COMMIT</span><span class="token punctuation">;</span></div></pre><p class="css-zitybv">The concept behind transactions is that no permanent change is done before the command <code class="css-1eipsn1">COMMIT</code>. Thus in the example above it is not possible for Maija to lose 100 euros and Uolevi getting nothing (remember the example from the beginning of the course?). Either the balance of both accounts are changed and the money is transferred successfully, or both balances remain unchanged.</p><p class="css-zitybv">If a transaction is interrupted for any reason before the <code class="css-1eipsn1">COMMIT</code>, all the changes in the transaction are cancelled. One reason for a transaction interruption could be a malfunction with the computer, but we can also ourselves terminate the transaction with the command <code class="css-1eipsn1">ROLLBACK</code>.</p><h2 id="testing-a-transaction" class="css-vq3asz">Testing a transaction</h2><p class="css-zitybv">A good way to gain knowledge of transactions is to try in practice, how they work. Here&#x27;s an example of a conversation with SQLite (with added linebreaks):</p><pre class="prism-code language-css-0 css-1itelf7"><div class="token-line"><span class="token plain">sqlite&gt; CREATE TABLE Accounts (id INTEGER PRIMARY KEY, owner TEXT, balance INTEGER);</span></div><div class="token-line"><span class="token plain">sqlite&gt; INSERT INTO Accounts (owner,balance) VALUES (&#x27;Uolevi&#x27;,350);</span></div><div class="token-line"><span class="token plain">sqlite&gt; INSERT INTO Accounts (owner,balance) VALUES (&#x27;Maija&#x27;,600);</span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">sqlite&gt; SELECT * FROM Accounts;</span></div><div class="token-line"><span class="token plain">1|Uolevi|350</span></div><div class="token-line"><span class="token plain">2|Maija|600</span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">sqlite&gt; BEGIN TRANSACTION;</span></div><div class="token-line"><span class="token plain">sqlite&gt; UPDATE Accounts SET balance=balance-100 WHERE owner=&#x27;Maija&#x27;;</span></div><div class="token-line"><span class="token plain">sqlite&gt; SELECT * FROM Accounts;</span></div><div class="token-line"><span class="token plain">1|Uolevi|350</span></div><div class="token-line"><span class="token plain">2|Maija|500</span></div><div class="token-line"><span class="token plain">sqlite&gt; ROLLBACK;</span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">sqlite&gt; SELECT * FROM Accounts;</span></div><div class="token-line"><span class="token plain">1|Uolevi|350</span></div><div class="token-line"><span class="token plain">2|Maija|600</span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">sqlite&gt; BEGIN TRANSACTION;</span></div><div class="token-line"><span class="token plain">sqlite&gt; UPDATE Accounts SET balance=balance-100 WHERE owner=&#x27;Maija&#x27;;</span></div><div class="token-line"><span class="token plain">sqlite&gt; UPDATE Accounts SET balance=balance+100 WHERE owner=&#x27;Uolevi&#x27;;</span></div><div class="token-line"><span class="token plain">sqlite&gt; COMMIT;</span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">sqlite&gt; SELECT * FROM Accounts;</span></div><div class="token-line"><span class="token plain">1|Uolevi|450</span></div><div class="token-line"><span class="token plain">2|Maija|500</span></div></pre><p class="css-zitybv">In the beginning, Uolevi has 350 euros on their account and Maija has 600 on theirs. In the first transaction we first remove 100 euros from Maija, but then we have a second thought and terminate the transaction. Thus the change made in the transaction is cancelled and the balances remain the same as in the beginning. We do complete the second transaction, for which Uolevi now has 450 euros and Maija has 500 euros on the account.</p><p class="css-zitybv">Notice, that we can see the changes <em class="css-0">inside the transaction</em>, even though they have not been permanently saved to the database. For example the <code class="css-1eipsn1">SELECT</code> query inside the first transaction shows Maija&#x27;s balance as 500 euros, since the previous <code class="css-1eipsn1">UPDATE</code> changed the balance.</p><h2 id="internal-implementation" class="css-vq3asz">Internal implementation</h2><p class="css-zitybv">Implementing transactions is a fascinating technical challenge in databases. In a way the transaction has to make changes to the database as the commands may be reliant on previous commands, but on the other hand nothing can be permanently changed before the transaction is completed.</p><p class="css-zitybv">One central idea behind databases is to save changes in two ways. First the description of the change is written into a <em class="css-0">log file</em> called <code class="css-1eipsn1">write-ahead log</code>, which can be thought of as a list of commands that have been run. Only after this the changes are done to the actual data structures of the database. Now if something surprising happens in the second phase, the changes are already saved in the log and can be run again later.</p><p class="css-zitybv">When making a transaction the database system also has to keep track of which ongoing changes are done by which transaction. In practice we can only make changes which are visible to certain transactions. If and only if the transaction is completed, the changes are made to the table row permanently.</p><h1 id="parallel-transactions" class="css-1up8dbe">Parallel transactions</h1><p class="css-zitybv">Additional mix to transaction handling is created when a database can have several users, whom all have transactions going on at the same time. How much should we isolate the transactions from one another?</p><p class="css-zitybv">Unfortunately we do not have a single answer for this, but the answer is dependant on the use case as well as the database qualities. In a way the best solution would be to completely isolate the transaction, but in practice this can affect the database usage negatively.</p><h2 id="transaction-isolation-levels" class="css-vq3asz">Transaction isolation levels</h2><p class="css-zitybv">The SQL standard defines the transaction isolation levels as follows:</p><ul class="css-0"><li class="css-0"><p class="css-zitybv">Level 1 (read uncommitted)
It is permitted that a transaction can see the changes done by another transaction, even though the other transaction is not yet committed (dirty read).</p></li><li class="css-0"><p class="css-zitybv">Level 2 (read committed)
Unlike on level 1, the transaction can only see the changes made by another transaction, if the other transaction has been committed.</p></li><li class="css-0"><p class="css-zitybv">Level 3 (repeatable read)
Requirements from level 2, and in addition if during a transaction a row is read multiple times, the content stays unchanged on each reading.</p></li><li class="css-0"><p class="css-zitybv">Level 4 (serializable)
Transactions are totally isolated and the commands act as if the transactions were run one at a time in some order.</p></li></ul><h2 id="example" class="css-vq3asz">Example</h2><p class="css-zitybv">Let&#x27;s examine a situation where the price for product 1 is 8 in the beginning and two users are running commands at the same time inside transactions (user 1 on the left, user 2 on the right):</p><pre class="language-sql prism-code language-sql css-1itelf7"><div class="token-line"><span class="token keyword">BEGIN</span><span class="token plain"> </span><span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                                       </span><span class="token keyword">BEGIN</span><span class="token plain"> </span><span class="token keyword">TRANSACTION</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                                       </span><span class="token keyword">UPDATE</span><span class="token plain"> Products </span><span class="token keyword">SET</span><span class="token plain"> price</span><span class="token operator">=</span><span class="token number">5</span><span class="token plain"> </span><span class="token keyword">WHERE</span><span class="token plain"> id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">SELECT</span><span class="token plain"> price </span><span class="token keyword">FROM</span><span class="token plain"> Products </span><span class="token keyword">WHERE</span><span class="token plain"> id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                                       </span><span class="token keyword">UPDATE</span><span class="token plain"> Products </span><span class="token keyword">SET</span><span class="token plain"> price</span><span class="token operator">=</span><span class="token number">7</span><span class="token plain"> </span><span class="token keyword">WHERE</span><span class="token plain"> id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                                       </span><span class="token keyword">COMMIT</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">SELECT</span><span class="token plain"> price </span><span class="token keyword">FROM</span><span class="token plain"> Products </span><span class="token keyword">WHERE</span><span class="token plain"> id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">COMMIT</span><span class="token punctuation">;</span></div></pre><p class="css-zitybv">On level 1, the user 1 can get results 5 and 7 on their query, as the changes of user 2 can be shown immediately, even though the transaction of user 2 has not yet been committed.</p><p class="css-zitybv">On level 2, user 1 can get results 8 and 7, as during the first query the transaction for user 2 has not been yet committed, but has been during the second query.</p><p class="css-zitybv">On levels 3 and 4, user 1 gets the query results as 8 and 8, as this is the situation before the transaction began, and a transaction done in between cannot change the content of the read row.</p><h2 id="transactions-in-practice" class="css-vq3asz">Transactions in practice</h2><p class="css-zitybv">The implementation and the available isolation levels depend on the database system used. For example in SQLite the only level is 4, whereas PostgreSQL has levels 2 to 4 available, defaulting to 2.</p><h2 id="why-use-different-levels" class="css-vq3asz">Why use different levels?</h2><p class="css-zitybv">The isolation level 4 is clearly the best, as the changes from transactions are not shown to each other. Why do the other levels exist, and why does PostgreSQL default to level 2?</p><p class="css-zitybv">The price of good isolation is slowing down the database, or even blocking transactions, as committing transactions might cause a conflict. On the other hand in many situations a lower level of isolation is more than enough, as long as the database user is aware of it.</p><p class="css-zitybv">Best source for knowledge on transactions is once again reading the database system documentation, as well as testing it yourself. For example we could ourselves run <em class="css-0">two</em> SQLite interpreters, open the same database and run transaction commands on both and observe the results.</p><p class="css-zitybv">The following conversation was run with the above setting:</p><pre class="prism-code language-css-0 css-1itelf7"><div class="token-line"><span class="token plain">sqlite&gt; BEGIN TRANSACTION;</span></div><div class="token-line"><span class="token plain">                                 sqlite&gt; BEGIN TRANSACTION;</span></div><div class="token-line"><span class="token plain">                                 sqlite&gt; UPDATE Products SET price=5 WHERE id=1;</span></div><div class="token-line"><span class="token plain">sqlite&gt; SELECT price FROM Products WHERE id=1;</span></div><div class="token-line"><span class="token plain">8</span></div><div class="token-line"><span class="token plain">                                 sqlite&gt; UPDATE Products SET price=7 WHERE id=1;</span></div><div class="token-line"><span class="token plain">                                 sqlite&gt; COMMIT;</span></div><div class="token-line"><span class="token plain">                                 Error: database is locked</span></div><div class="token-line"><span class="token plain">sqlite&gt; SELECT price FROM Products WHERE id=1;</span></div><div class="token-line"><span class="token plain">8</span></div><div class="token-line"><span class="token plain">sqlite&gt; COMMIT;</span></div></pre><p class="css-zitybv">Here we can see the first transaction indeed gets 8 as a result for both queries. We cannot infact even commit the second transaction but get an error message <code class="css-1eipsn1">Error: database is locked</code> as the database is locked due to the other transaction being uncommitted. The isolation indeed works well, but we would have to try again to commit the second transaction.</p><p class="css-zitybv">For comparison, here&#x27;s the same conversation with PostgreSQL and level 2:</p><pre class="prism-code language-css-0 css-1itelf7"><div class="token-line"><span class="token plain">user=&gt; BEGIN TRANSACTION;</span></div><div class="token-line"><span class="token plain">                                 user=&gt; BEGIN TRANSACTION;</span></div><div class="token-line"><span class="token plain">                                 user=&gt; UPDATE Products SET price=5 WHERE id=1;</span></div><div class="token-line"><span class="token plain">user=&gt; SELECT price FROM Products WHERE id=1;</span></div><div class="token-line"><span class="token plain">8</span></div><div class="token-line"><span class="token plain">                                 user=&gt; UPDATE Products SET price=7 WHERE id=1;</span></div><div class="token-line"><span class="token plain">                                 user=&gt; COMMIT;</span></div><div class="token-line"><span class="token plain">user=&gt; SELECT price FROM Products WHERE id=1;</span></div><div class="token-line"><span class="token plain">7</span></div><div class="token-line"><span class="token plain">user=&gt; COMMIT;</span></div></pre><p class="css-zitybv">Now the value changed to 7 by the second transaction is returned to the first transaction, but on the other hand both transactions are committed without a problem.</p></main></div><style data-emotion="css 7oi17p">.css-7oi17p{display:none;-webkit-flex:0 0 16rem;-ms-flex:0 0 16rem;flex:0 0 16rem;font-size:0.75rem;font-weight:600;}@media (min-width: 56.36842105263158em){.css-7oi17p{display:block;}}</style><aside class="css-7oi17p e18xy85f4"><style data-emotion="css dxzn2c">.css-dxzn2c{position:fixed;top:0;bottom:0;overflow-x:hidden;overflow-y:auto;width:16rem;height:100%;padding:7rem 1rem 0;}</style><nav class="css-dxzn2c e18xy85f3"><style data-emotion="css 1w6ve1a">.css-1w6ve1a{margin-top:0;font-size:0.7rem;font-weight:700;text-transform:uppercase;}</style><p class="css-1w6ve1a e18xy85f2">Contents</p><style data-emotion="css evawql">.css-evawql{margin:0;padding:0;list-style:none;}.css-evawql ul{margin:0;padding:0;list-style:none;}</style><ul class="css-evawql e18xy85f1"><style data-emotion="css 1uvgd5">.css-1uvgd5{margin:0.3rem 0;}</style><li class="css-1uvgd5 e18xy85f0"><style data-emotion="css 1j0udpt">.css-1j0udpt{display:inline-block;padding:0.2rem 0;width:100%;color:var(--theme-ui-colors-text);-webkit-text-decoration:none;text-decoration:none;-webkit-transition:color 0.2s ease-out;transition:color 0.2s ease-out;}.css-1j0udpt:hover,.css-1j0udpt:focus{color:var(--theme-ui-colors-primary);}</style><a href="/databases/part6#data-integrity" class="css-1j0udpt e1r4v4s10">Data integrity</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#column-conditions" class="css-1j0udpt e1r4v4s10">Column conditions</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#unique" class="css-1j0udpt e1r4v4s10">UNIQUE</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#not-null-and-default" class="css-1j0udpt e1r4v4s10">NOT NULL and DEFAULT</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#check" class="css-1j0udpt e1r4v4s10">CHECK</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#condition-monitoring" class="css-1j0udpt e1r4v4s10">Condition monitoring</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#reference-conditions" class="css-1j0udpt e1r4v4s10">Reference conditions</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#reference-keys-in-sqlite" class="css-1j0udpt e1r4v4s10">Reference keys in SQLite</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#references-and-removals" class="css-1j0udpt e1r4v4s10">References and removals</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#consequences-of-removal" class="css-1j0udpt e1r4v4s10">Consequences of removal</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#introduction-to-transactions" class="css-1j0udpt e1r4v4s10">Introduction to transactions</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#acid" class="css-1j0udpt e1r4v4s10">ACID</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#transaction-phases" class="css-1j0udpt e1r4v4s10">Transaction phases</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#testing-a-transaction" class="css-1j0udpt e1r4v4s10">Testing a transaction</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#internal-implementation" class="css-1j0udpt e1r4v4s10">Internal implementation</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#parallel-transactions" class="css-1j0udpt e1r4v4s10">Parallel transactions</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#transaction-isolation-levels" class="css-1j0udpt e1r4v4s10">Transaction isolation levels</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#example" class="css-1j0udpt e1r4v4s10">Example</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#transactions-in-practice" class="css-1j0udpt e1r4v4s10">Transactions in practice</a></li><li class="css-1uvgd5 e18xy85f0"><a href="/databases/part6#why-use-different-levels" class="css-1j0udpt e1r4v4s10">Why use different levels?</a></li></ul></nav></aside><style data-emotion="css jl45xv">.css-jl45xv{text-align:center;position:absolute;bottom:0;width:100%;height:6rem;padding-top:10px;font-size:1rem;background:var(--theme-ui-colors-footer);color:var(--theme-ui-colors-text);}.css-jl45xv a{-webkit-text-decoration:none;text-decoration:none;color:var(--theme-ui-colors-background);}</style><footer class="css-jl45xv e1krdi8y0"><p>© <!-- -->2024<!-- -->, Built with<a href="https://web.centria.fi/"> Centria</a></p><p>More information about <a href="/databases/license">License</a></p></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/part6";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-0d51d282d68ddbc99621.js"],"app":["/app-ed530a94b36d312dc3da.js"],"component---src-pages-404-js":["/component---src-pages-404-js-e7816ca82cb45e322130.js"],"component---src-templates-docs-js":["/component---src-templates-docs-js-c82167b9612215b3fdf2.js"]};/*]]>*/</script><script src="/databases/polyfill-0d51d282d68ddbc99621.js" nomodule=""></script><script src="/databases/component---src-templates-docs-js-c82167b9612215b3fdf2.js" async=""></script><script src="/databases/commons-2a140772cd0d960d3ca2.js" async=""></script><script src="/databases/app-ed530a94b36d312dc3da.js" async=""></script><script src="/databases/framework-d79a9ccabaa25efea902.js" async=""></script><script src="/databases/webpack-runtime-268f6552388089c91965.js" async=""></script></body></html>